<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dpl1000DAO">

	
	<typeAlias  alias="egovMap" 	type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="BuildVO"	type="kr.opensoftlab.sdf.jenkins.vo.BuildVO"/>
	<typeAlias alias="ChangeVO"	type="kr.opensoftlab.sdf.jenkins.vo.ChangeVO"/>
	<typeAlias alias="ChangePathsVO"	type="kr.opensoftlab.sdf.jenkins.vo.ChangePathsVO"/>
	
	
    <resultMap id="resultMapDpl1400SelBuildInfo" class="HashMap">
		<result property="prjId" 				column="PRJ_ID" />
		<result property="dplId" 				column="DPL_ID" />
		<result property="dplNm" 				column="DPL_NM" />
		<result property="jenId" 				column="JEN_ID" />
		<result property="jobId" 				column="JOB_ID" />
		<result property="jobRestoreId" 		column="JOB_RESTORE_ID" />
		<result property="bldSeq" 				column="BLD_SEQ" />
		<result property="bldNum" 				column="BLD_NUM" />
		<result property="bldMainNum" 			column="BLD_MAIN_NUM" />
		<result property="bldResult" 			column="BLD_RESULT" />
		<result property="bldResultMsg" 		column="BLD_RESULT_MSG" />
		<result property="bldDurationTm" 		column="BLD_DURATION_TM" />
		<result property="bldStartDtm" 			column="BLD_START_DTM" />
		<result property="bldConsoleLog" 		column="BLD_CONSOLE_LOG" jdbcType="CLOB" javaType="java.lang.String"/>
		<result property="bldRestoreNum"		column="BLD_RESTORE_NUM" />
		<result property="bldRestoreResult" 	column="BLD_RESTORE_RESULT" />
		<result property="bldRestoreResultMsg" 	column="BLD_RESTORE_RESULT_MSG" />
		<result property="bldConsoleRestoreLog" column="BLD_CONSOLE_RESTORE_LOG" jdbcType="CLOB" javaType="java.lang.String"/>
		<result property="regDtm" 				column="REG_DTM" />
		<result property="regUsrId" 			column="REG_USR_ID" />
		<result property="regUsrIp" 			column="REG_USR_IP" />
		<result property="modifyDtm" 			column="MODIFY_DTM" />
		<result property="modifyUsrId" 			column="MODIFY_USR_ID" />
		<result property="modifyUsrIp" 			column="MODIFY_USR_IP" />
	</resultMap> 
	
	
	<sql id="selectDpl1000DplListbase">
			SELECT
					ROWNUM AS RN
				,	SUB1.PRJ_GRP_ID
				,	SUB1.PRJ_ID
				,	SUB1.DPL_ID
				,	SUB1.DPL_NM
				,	SUB1.DPL_VER
				,	SUB1.DPL_DT
				,	SUB1.DPL_USR_ID
				,	SUB1.DPL_USR_NM
				,	SF_STM3000_USR_INFO(SUB1.DPL_USR_ID, '6')  AS DPL_USR_IMG_ID
				,	SUB1.DPL_DESC
				,	SUB1.DPL_STS_CD
				,	SUB1.DPL_STS_NM
				,	SUB1.DPL_TYPE_CD
				,	SUB1.DPL_TYPE_NM
				,	SUB1.DPL_REVISION_NUM
				,	SUB1.DPL_AUTO_AFTER_CD
				,	SUB1.DPL_AUTO_AFTER_NM
				,	SUB1.DPL_AUTO_DTM
				,	SUB1.DPL_ST_DTM
				,	SUB1.DPL_RESTORE_CD
				,	SUB1.DPL_RESTORE_NM
				,	SUB1.DPL_SIGN_USE_CD
				,	SUB1.DPL_SIGN_USE_NM
				,	SUB1.DPL_SIGN_TXT
				, 	SUB1.DPL_AUTO_REPEAT_CD
		        , 	SUB1.DPL_AUTO_REPEAT_NM
		        , 	SUB1.DPL_REPEAT_CYCLE_CD
		        , 	SUB1.DPL_REPEAT_CYCLE_NM
		        , 	SUB1.DPL_REPEAT_ED_DTM
		        , 	SUB1.DPL_REPEAT_DAY_CD
		        , 	SUB1.DPL_REPEAT_DAY
		        ,	SUB1.DPL_REPEAT_DAY_ENG
		        ,	SUB1.AUTO_DPL_REVISION_SEL_NM
				,	SUB1.DPL_DEL_CD
				,	SUB1.DPL_JOB_CNT
				,	NVL(SUB1.BLD_RESULT_CNT, 0) AS BLD_RESULT_CNT
        		, 	NVL(SUB1.BLD_SUCC_RESULT_CNT, 0) AS BLD_SUCC_RESULT_CNT
        		, 	NVL(TRUNC((SUB1.BLD_SUCC_RESULT_CNT/SUB1.BLD_RESULT_CNT)*100), 0) AS BLD_SUCC_PERCENT
				,	SUB1.REG_DTM
				,	SUB1.REG_USR_ID
				,	SUB1.REG_USR_IP
				,	SUB1.MODIFY_DTM
				,	SUB1.MODIFY_USR_ID
				,	SUB1.MODIFY_USR_IP	
				, 	SUB1.TARGET_ID
		       	, 	SUB1.TARGET_CD
		        , 	SUB1.ORD
		        , 	SUB1.LAST_SIGN_USR_ID
		        , 	SF_STM3000_USR_INFO(SUB1.LAST_SIGN_USR_ID, '1') AS LAST_SIGN_USR_NM
		        , 	SF_STM3000_USR_INFO(SUB1.LAST_SIGN_USR_ID, '6') AS LAST_SIGN_USR_IMG_ID
		        , 	SUB1.NOW_SIGN_TYPE_CD
				,	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'CMM00008' AND X.SUB_CD = SUB1.NOW_SIGN_TYPE_CD) AS NOW_SIGN_TYPE_NM
				,	SUB1.LAST_ORD
				,	SUB1.SIGN_LINE_ID
		FROM
		(
			SELECT
					( SELECT X.PRJ_GRP_ID FROM PRJ1000 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.PRJ_ID = A.PRJ_ID) AS PRJ_GRP_ID
				,	A.PRJ_ID
				,	A.DPL_ID
				,	A.DPL_NM
				,	A.DPL_VER
				,	TO_CHAR(A.DPL_DT, 'YYYY-MM-DD') AS DPL_DT
				,	A.DPL_USR_ID
				, 	(SELECT USR_NM FROM STM3000 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.USR_ID = A.DPL_USR_ID ) AS DPL_USR_NM
				,	A.DPL_DESC
				,	A.DPL_STS_CD
				, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00001' AND X.SUB_CD = A.DPL_STS_CD) AS DPL_STS_NM
				,	A.DPL_TYPE_CD
				, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00003' AND X.SUB_CD = A.DPL_TYPE_CD) AS DPL_TYPE_NM
				,	A.DPL_REVISION_NUM
				,	A.DPL_AUTO_AFTER_CD
				, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00004' AND X.SUB_CD = A.DPL_AUTO_AFTER_CD) AS DPL_AUTO_AFTER_NM
				,	TO_CHAR(A.DPL_AUTO_DTM, 'YYYY-MM-DD HH24:MI:SS') AS DPL_AUTO_DTM
				,	TO_DATE(TO_CHAR(A.DPL_DT,'YYYY-MM-DD') || ' ' || TO_CHAR(A.DPL_AUTO_DTM,'HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') AS DPL_ST_DTM
				,	A.DPL_RESTORE_CD
				, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00005' AND X.SUB_CD = A.DPL_RESTORE_CD) AS DPL_RESTORE_NM
				,	A.DPL_SIGN_USE_CD
				, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'CMM00001' AND X.SUB_CD = A.DPL_SIGN_USE_CD) AS DPL_SIGN_USE_NM
				,	A.DPL_SIGN_TXT
				, 	A.DPL_AUTO_REPEAT_CD
        		,	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'CMM00001' AND X.SUB_CD = A.DPL_AUTO_REPEAT_CD) AS DPL_AUTO_REPEAT_NM
        		, 	A.DPL_REPEAT_CYCLE_CD
        		, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00008' AND X.SUB_CD = A.DPL_REPEAT_CYCLE_CD) AS DPL_REPEAT_CYCLE_NM
        		,	TO_CHAR(A.DPL_REPEAT_ED_DTM, 'YYYY-MM-DD HH24:MI:SS') AS DPL_REPEAT_ED_DTM
        		, 	A.DPL_REPEAT_DAY_CD
        		, 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'CMM00012' AND X.SUB_CD = A.DPL_REPEAT_DAY_CD) AS DPL_REPEAT_DAY
        		,	(SELECT X.SUB_CD_REF1 FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'CMM00012' AND X.SUB_CD = A.DPL_REPEAT_DAY_CD) AS DPL_REPEAT_DAY_ENG
				,	AUTO_DPL_REVISION_SEL_CD
				,	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00009' AND X.SUB_CD = A.AUTO_DPL_REVISION_SEL_CD) AS AUTO_DPL_REVISION_SEL_NM
				,	A.DPL_DEL_CD
				,	(SELECT COUNT(*) FROM DPL1300 X WHERE X.PRJ_ID = A.PRJ_ID AND X.DPL_ID = A.DPL_ID) AS DPL_JOB_CNT
				,	(
         				SELECT COUNT(*) AS BLD_RESULT_CNT
						FROM DPL1400 X
						WHERE 1=1
						AND X.BLD_RESULT_CD NOT IN('01','02')
						AND X.PRJ_ID = A.PRJ_ID
						AND X.DPL_ID = A.DPL_ID
						GROUP BY X.PRJ_ID, X.DPL_ID 
        			) AS BLD_RESULT_CNT
        		,	(
        				SELECT COUNT(DECODE(X.BLD_RESULT,'SUCCESS',1)) AS BLD_SUCC_RESULT_CNT
						FROM DPL1400 X
						WHERE 1=1
						AND X.BLD_RESULT_CD NOT IN('01','02')
						AND X.PRJ_ID = A.PRJ_ID
						AND X.DPL_ID = A.DPL_ID
						GROUP BY X.PRJ_ID, X.DPL_ID 
        			) AS BLD_SUCC_RESULT_CNT
				,	A.REG_DTM
				,	A.REG_USR_ID
				,	A.REG_USR_IP
				,	A.MODIFY_DTM
				,	A.MODIFY_USR_ID
				,	A.MODIFY_USR_IP	
				,  	C.TARGET_ID
			    ,	C.TARGET_CD
			    ,	C.ORD
			    ,	CASE WHEN C.SIGN_TYPE_CD='01' OR C.SIGN_TYPE_CD='02' THEN D.ORD ELSE C.ORD END AS LAST_ORD
			    , 	CASE WHEN C.SIGN_TYPE_CD='01' OR C.SIGN_TYPE_CD='02' THEN D.SIGN_USR_ID ELSE C.SIGN_USR_ID END AS LAST_SIGN_USR_ID
			    , 	SF_STM3000_USR_INFO(CASE WHEN C.SIGN_TYPE_CD='01' OR C.SIGN_TYPE_CD='02' THEN D.SIGN_USR_ID ELSE C.SIGN_USR_ID END, '1') AS LAST_SIGN_USR_NM
				, 	CASE WHEN C.SIGN_TYPE_CD ='01' THEN  '02' ELSE C.SIGN_TYPE_CD END AS NOW_SIGN_TYPE_CD
				,	A.SIGN_LINE_ID
			FROM DPL1000 A
			LEFT JOIN	(
							SELECT 	LIC_GRP_ID
								,	PRJ_ID 
								, 	TARGET_ID
								, 	TARGET_CD
								, 	MAX(SIGN_DTM) AS MAX_SIGN_DTM 
                				,	MAX(SIGN_LINE_ID) AS SIGN_LINE_ID
							FROM 	CMM6601 
							GROUP BY  LIC_GRP_ID
									, PRJ_ID
									, TARGET_CD
									, TARGET_ID
						) B
		    ON (A.PRJ_ID = B.PRJ_ID AND A.DPL_ID = B.TARGET_ID)
		    LEFT JOIN CMM6601 C 
		    ON (B.LIC_GRP_ID = C.LIC_GRP_ID AND B.PRJ_ID = C.PRJ_ID AND B.TARGET_ID = C.TARGET_ID AND B.TARGET_CD = C.TARGET_CD AND B.MAX_SIGN_DTM = C.SIGN_DTM AND B.SIGN_LINE_ID = C.SIGN_LINE_ID)
		    LEFT JOIN (SELECT * FROM CMM6600 WHERE DEL_CD = '02') D
		    ON (B.LIC_GRP_ID = D.LIC_GRP_ID AND B.PRJ_ID = D.PRJ_ID AND B.TARGET_ID = D.TARGET_ID AND B.TARGET_CD = D.TARGET_CD AND (C.ORD+1) = D.ORD)
			WHERE 1=1
			AND A.PRJ_ID = #prjId#
			AND A.DPL_DEL_CD = '02'
			<isNotEmpty property="paramDplStsCd">
				AND A.DPL_STS_CD = #paramDplStsCd#
			</isNotEmpty>
			<isNotEmpty property="paramSortFieldId">
				<isNotEmpty property="sortDirection">
					ORDER BY $paramSortFieldId$
					<isEqual property="sortDirection" compareValue="desc">
						DESC
					</isEqual>
					<isEqual property="sortDirection" compareValue="asc">
						ASC
					</isEqual>
				</isNotEmpty>
			</isNotEmpty> 
			<isEmpty property="paramSortFieldId">
				ORDER BY A.REG_DTM DESC	
			</isEmpty> 
		) SUB1
		WHERE 1=1
		<isNotEmpty property="paramSearchData">
			AND SUB1.DPL_NM LIKE '%'|| #paramSearchData# ||'%'
		</isNotEmpty>
		<isNotEmpty property="searchTargetData">
			<isNotEmpty property="searchTargetId">
				<isEqual property="searchTargetId" compareValue="dplNm">
					AND	SUB1.DPL_NM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplVer">
					AND	SUB1.DPL_VER LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplUsrNm">
					AND	SUB1.DPL_USR_NM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplDesc">
				<![CDATA[
					AND	SUB1.DPL_DESC LIKE '%'|| #searchTargetData# ||'%'
				]]>
				</isEqual>
				<isEqual property="searchTargetId" compareValue="lastSignUsrNm">
					AND	SUB1.LAST_SIGN_USR_NM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplStsCd">
					AND	SUB1.DPL_STS_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplTypeCd">
					AND	SUB1.DPL_TYPE_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplAutoAfterCd">
					AND	SUB1.DPL_AUTO_AFTER_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplRestoreCd">
					AND	SUB1.DPL_RESTORE_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplSignUseCd">
					AND	SUB1.DPL_SIGN_USE_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplAutoRepeatCd">
					AND	SUB1.DPL_AUTO_REPEAT_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplRepeatCycleCd">
					AND	SUB1.DPL_AUTO_REPEAT_CD = '01'
					AND	SUB1.DPL_REPEAT_CYCLE_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="nowSignTypeCd">
					AND	SUB1.NOW_SIGN_TYPE_CD = #searchTargetData#
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplDt">
					<isNotEmpty property="searchStartDt">
						AND TO_DATE(SUB1.DPL_DT, 'YYYY-MM-DD HH24:MI:SS') &gt;= TO_DATE(#searchStartDt#, 'YYYY-MM-DD HH24:MI:SS')
					</isNotEmpty>
					<isNotEmpty property="searchEndDt">
						 AND TO_DATE(SUB1.DPL_DT, 'YYYY-MM-DD HH24:MI:SS') &lt;= TO_DATE(#searchEndDt#, 'YYYY-MM-DD HH24:MI:SS')  
					</isNotEmpty>
				</isEqual>
				<isEqual property="searchTargetId" compareValue="dplAutoDtm">
					<isNotEmpty property="searchStartDt">
						AND	TO_DATE(#searchStartDt#, 'YYYY-MM-DD') &gt;= TO_CHAR(SUB1.DPL_AUTO_DTM, 'YYYY-MM-DD')  
					</isNotEmpty>
					<isNotEmpty property="searchEndDt">
						AND	TO_DATE(#searchEndDt#, 'YYYY-MM-DD') &lt;= TO_CHAR(SUB1.DPL_AUTO_DTM, 'YYYY-MM-DD')   
					</isNotEmpty>
				</isEqual>
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty property="dplIdList">
			AND	SUB1.DPL_ID IN
			<iterate property="dplIdList" open="(" close=")" conjunction=",">
				#dplIdList[]#
			</iterate>
		</isNotEmpty>
	</sql>
	
	
	<sql id="selectDpl1300DplJobListBase">
		SELECT
				ROWNUM AS RN
	        ,   SUB1.PRJ_ID
			,	SUB1.DPL_ID
			,	SUB1.DPL_NM
			,	SUB1.JEN_ID
			,	SUB1.JEN_NM
			,	SUB1.JEN_URL
			,	SUB1.JEN_USR_ID
			,	SUB1.JEN_USR_TOK
			,	SUB1.JOB_ID
			,	SUB1.JOB_RESTORE_ID
			,	SUB1.JOB_TOK
			,	SUB1.JOB_TYPE_CD
			,	SUB1.JOB_DESC
			,	SF_STM4001_COM_CD_INFO(#licGrpId#, 'DPL00002', SUB1.JOB_TYPE_CD, '1') AS JOB_TYPE_NM
			,	SUB1.JOB_PARAMETER
			,	SUB1.JOB_START_ORD
			,	SUB1.USE_CD
			,	SF_STM4001_COM_CD_INFO(#licGrpId#, 'CMM00001', SUB1.USE_CD, '1') AS USE_NM
			,	SUB1.BLD_NUM
			,	SUB1.BLD_RESULT
			,	SUB1.BLD_RESULT_MSG
			,	SUB1.BLD_SEQ
			,	SUB1.BLD_RESTORE_NUM
			,	SUB1.BLD_RESTORE_RESULT
			,	SUB1.BLD_RESTORE_RESULT_MSG
			,	SUB1.BLD_RESTORE_SEQ
			,	SUB1.REG_DTM
			,	SUB1.REG_USR_ID
			,	SUB1.REG_USR_IP
			,	SUB1.MODIFY_DTM
			,	SUB1.MODIFY_USR_ID
			,	SUB1.MODIFY_USR_IP
		FROM
		(
			SELECT 
		            A.PRJ_ID
				,	A.DPL_ID
				,	(SELECT X.DPL_NM FROM DPL1000 X WHERE X.PRJ_ID = A.PRJ_ID AND X.DPL_ID = A.DPL_ID) AS DPL_NM
				,	A.JEN_ID
				,	B.JEN_NM
				,	B.JEN_URL
				,	B.JEN_USR_ID
				,	B.JEN_USR_TOK
				,	A.JOB_ID
				,	C.JOB_RESTORE_ID
				,	C.JOB_TOK
				,	C.JOB_TYPE_CD
				,	C.JOB_DESC
				,	C.JOB_PARAMETER
				,	A.JOB_START_ORD
				,	A.USE_CD
				,	D.BLD_NUM
				,	D.BLD_RESULT
				,	D.BLD_RESULT_MSG
				,	D.BLD_SEQ
				,	E.BLD_NUM AS BLD_RESTORE_NUM
				,	E.BLD_RESULT AS BLD_RESTORE_RESULT
				,	E.BLD_RESULT_MSG AS BLD_RESTORE_RESULT_MSG
				,	E.BLD_SEQ AS BLD_RESTORE_SEQ
				,	A.REG_DTM
				,	A.REG_USR_ID
				,	A.REG_USR_IP
				,	A.MODIFY_DTM
				,	A.MODIFY_USR_ID
				,	A.MODIFY_USR_IP
			<isNotEqual property="sprTypeCd" compareValue="03">
		    FROM DPL1300 A 
		    LEFT JOIN STM9000 B 
		    ON(B.LIC_GRP_ID = #licGrpId# AND A.JEN_ID = B.JEN_ID)
			LEFT JOIN STM9001 C 
			ON(C.LIC_GRP_ID = B.LIC_GRP_ID AND C.JEN_ID = A.JEN_ID AND C.JOB_ID = A.JOB_ID)
			LEFT JOIN DPL1400 D 
			ON(D.PRJ_ID = A.PRJ_ID AND D.DPL_ID = A.DPL_ID AND D.JEN_ID = C.JEN_ID AND D.JOB_ID = C.JOB_ID AND D.BLD_SEQ = SF_DPL1400_LAST_INFO(D.PRJ_ID,D.DPL_ID,D.JEN_ID,D.JOB_ID,'8'))
			LEFT JOIN (
			    SELECT *
			    FROM DPL1400 Y
			    WHERE 1=1
			    AND Y.BLD_SEQ = (
						SELECT
						MAX(Z.BLD_SEQ)
						FROM DPL1400 Z
						WHERE 1=1
                       	AND Z.PRJ_ID = Y.PRJ_ID
                       	AND Z.DPL_ID = Y.DPL_ID 
                       	AND Z.JEN_ID = Y.JEN_ID
                       	AND Z.JOB_ID = Y.JOB_ID
				)
			) E 
			ON (E.PRJ_ID = D.PRJ_ID AND E.DPL_ID = D.DPL_ID AND E.JEN_ID = D.JEN_ID AND E.JOB_ID = C.JOB_RESTORE_ID AND E.BLD_MAIN_NUM = D.BLD_NUM)
			INNER JOIN DPL1000 F
			ON (A.PRJ_ID = F.PRJ_ID AND A.DPL_ID = F.DPL_ID AND DPL_DEL_CD = '02')
		    WHERE 1=1
		    AND A.PRJ_ID = #prjId#
		    AND A.DPL_ID = #dplId#
		    AND A.USE_CD = '01'
		    AND B.USE_CD = '01'
		    AND C.USE_CD = '01'
		    </isNotEqual>
		    <isEqual property="sprTypeCd" compareValue="03">
		    FROM SNP_DPL1300 A 
		    LEFT JOIN SNP_STM9000 B 
		    ON(A.LIC_GRP_ID = B.LIC_GRP_ID AND A.PRJ_GRP_ID = B.PRJ_GRP_ID AND A.PRJ_ID = B.PRJ_ID AND A.SPR_ID = B.SPR_ID AND A.JEN_ID = B.JEN_ID)
			LEFT JOIN SNP_STM9001 C 
			ON(A.LIC_GRP_ID = C.LIC_GRP_ID AND A.PRJ_GRP_ID = C.PRJ_GRP_ID AND A.PRJ_ID = C.PRJ_ID AND A.SPR_ID = C.SPR_ID AND C.JEN_ID = A.JEN_ID AND C.JOB_ID = A.JOB_ID)
			LEFT JOIN SNP_DPL1400 D 
			ON(A.LIC_GRP_ID = D.LIC_GRP_ID AND A.PRJ_GRP_ID = D.PRJ_GRP_ID AND A.PRJ_ID = D.PRJ_ID AND A.SPR_ID = D.SPR_ID AND D.DPL_ID = A.DPL_ID AND D.JEN_ID = C.JEN_ID AND D.JOB_ID = C.JOB_ID AND D.BLD_SEQ = SF_DPL1400_LAST_INFO(D.PRJ_ID,D.DPL_ID,D.JEN_ID,D.JOB_ID,'8'))
			LEFT JOIN (
			    SELECT *
			    FROM SNP_DPL1400 Y
			    WHERE 1=1
			    AND Y.BLD_SEQ = (
						SELECT
						MAX(Z.BLD_SEQ)
						FROM SNP_DPL1400 Z
						WHERE 1=1
						AND Z.LIC_GRP_ID = Y.LIC_GRP_ID
						AND Z.PRJ_GRP_ID = Y.PRJ_GRP_ID
                       	AND Z.PRJ_ID = Y.PRJ_ID
                       	AND Z.SPR_ID = Y.SPR_ID
                       	AND Z.DPL_ID = Y.DPL_ID 
                       	AND Z.JEN_ID = Y.JEN_ID
                       	AND Z.JOB_ID = Y.JOB_ID
				)
			) E 
			ON (A.LIC_GRP_ID = E.LIC_GRP_ID AND A.PRJ_GRP_ID = E.PRJ_GRP_ID AND A.PRJ_ID = E.PRJ_ID AND A.SPR_ID = E.SPR_ID AND E.DPL_ID = D.DPL_ID AND E.JEN_ID = D.JEN_ID AND E.JOB_ID = C.JOB_RESTORE_ID AND E.BLD_MAIN_NUM = D.BLD_NUM)
			INNER JOIN SNP_DPL1000 F
			ON (A.LIC_GRP_ID = F.LIC_GRP_ID AND A.PRJ_GRP_ID = F.PRJ_GRP_ID AND A.PRJ_ID = F.PRJ_ID AND A.SPR_ID = F.SPR_ID AND A.DPL_ID = F.DPL_ID AND DPL_DEL_CD = '02')
		    WHERE 1=1
		    AND A.LIC_GRP_ID = #licGrpId#
		    AND A.PRJ_GRP_ID = #prjGrpId#
		    AND A.PRJ_ID = #prjId#
		    AND A.SPR_ID = #sprId#
		    AND A.DPL_ID = #dplId#
		    AND A.USE_CD = '01'
		    AND B.USE_CD = '01'
		    AND C.USE_CD = '01'
		    </isEqual>
		) SUB1
		WHERE 1 = 1
		<isNotEmpty property="searchTargetData">
			<isNotEmpty property="searchTargetId">
				<isEqual property="searchTargetId" compareValue="jenNm">
					AND	SUB1.JEN_NM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="jobId">
					AND	SUB1.JOB_ID LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="bldResultMsg">
					AND	SUB1.BLD_RESULT_MSG LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="jobTypeCd">
					AND	SUB1.JOB_TYPE_CD = #searchTargetData#
				</isEqual>
			</isNotEmpty>
		</isNotEmpty>
		<isNotEmpty property="paramSortFieldId">
			<isNotEmpty property="sortDirection">
				ORDER BY $paramSortFieldId$
				<isEqual property="sortDirection" compareValue="desc">
					DESC
				</isEqual>
			</isNotEmpty>
		</isNotEmpty>
		<isEmpty property="paramSortFieldId">
			ORDER BY SUB1.JOB_START_ORD
		</isEmpty>
	</sql>
	
	
	<sql id="selectDpl1400DplBldNumBase">
		SELECT
				ROWNUM RN
			,	SUB1.PRJ_ID
			,	SUB1.DPL_ID
			,	SUB1.JEN_ID
			,	SUB1.JOB_ID
			,	SUB1.BLD_SEQ
			,	SUB1.BLD_NUM
			,	SUB1.BLD_RESULT
			,	SUB1.BLD_RESULT_MSG
			,	SUB1.BLD_DURATION_TM
			,	SUB1.BLD_START_DTM
			,	SUB1.REG_DTM
			,	SUB1.USR_IMG_ID
			,	SUB1.REG_USR_NM
			,	SUB1.REG_USR_ID
			,	SUB1.REG_USR_IP
			,	SUB1.MODIFY_DTM
			,	SUB1.MODIFY_USR_ID
			,	SUB1.MODIFY_USR_IP
		FROM
		(
			 SELECT
					A.PRJ_ID
				,	A.DPL_ID
				,	A.JEN_ID
				,	A.JOB_ID
				,	A.BLD_SEQ
				,	A.BLD_NUM
				,	A.BLD_RESULT
				,	A.BLD_RESULT_MSG
				,	A.BLD_DURATION_TM
				,	A.BLD_START_DTM
				,	A.REG_DTM
				,	(SELECT USR_IMG_ID FROM STM3000 Z WHERE Z.USR_ID = A.REG_USR_ID) AS USR_IMG_ID
				,	(SELECT USR_NM FROM STM3000 Z WHERE Z.USR_ID = A.REG_USR_ID) AS REG_USR_NM
				,	A.REG_USR_ID
				,	A.REG_USR_IP
				,	A.MODIFY_DTM
				,	A.MODIFY_USR_ID
				,	A.MODIFY_USR_IP
			<isNotEqual property="sprTypeCd" compareValue="03">
			FROM DPL1400 A JOIN
			(
				SELECT Z.PRJ_ID, Z.DPL_ID, Z.JEN_ID, Z.JOB_ID, Z.BLD_NUM,MAX(BLD_SEQ) AS MAX_BLD_SEQ
				FROM DPL1400 Z
				WHERE 1=1
				GROUP BY Z.PRJ_ID, Z.DPL_ID, Z.JEN_ID, Z.JOB_ID, Z.BLD_NUM
			) B ON(A.PRJ_ID = B.PRJ_ID AND A.DPL_ID = B.DPL_ID AND A.JEN_ID = B.JEN_ID AND A.JOB_ID = B.JOB_ID AND A.BLD_NUM = B.BLD_NUM AND A.BLD_SEQ = B.MAX_BLD_SEQ)
			WHERE 1=1
			</isNotEqual>
			<isEqual property="sprTypeCd" compareValue="03">
			FROM SNP_DPL1400 A JOIN
			(
				SELECT Z.LIC_GRP_ID, Z.PRJ_GRP_ID, Z.PRJ_ID, Z.SPR_ID, Z.DPL_ID, Z.JEN_ID, Z.JOB_ID, Z.BLD_NUM,MAX(BLD_SEQ) AS MAX_BLD_SEQ
				FROM SNP_DPL1400 Z
				WHERE 1=1
				GROUP BY Z.LIC_GRP_ID, Z.PRJ_GRP_ID, Z.PRJ_ID, Z.SPR_ID, Z.DPL_ID, Z.JEN_ID, Z.JOB_ID, Z.BLD_NUM
			) B ON(A.LIC_GRP_ID = B.LIC_GRP_ID AND A.PRJ_GRP_ID = B.PRJ_GRP_ID AND A.PRJ_ID = B.PRJ_ID AND A.SPR_ID = B.SPR_ID AND A.DPL_ID = B.DPL_ID AND A.JEN_ID = B.JEN_ID AND A.JOB_ID = B.JOB_ID AND A.BLD_NUM = B.BLD_NUM AND A.BLD_SEQ = B.MAX_BLD_SEQ)
			WHERE 1=1
			AND A.LIC_GRP_ID = #licGrpId#
			AND A.PRJ_GRP_ID = #prjGrpId#
			AND A.PRJ_ID = #prjId#
			AND A.SPR_ID = #sprId#
			</isEqual>
			AND A.BLD_NUM > 0
			AND A.JEN_ID = #jenId#
			AND A.JOB_ID = #jobId#
			<isNotEmpty property="paramSortFieldId">
				ORDER BY $paramSortFieldId$
				<isEqual property="sortDirection" compareValue="asc">
					ASC
				</isEqual>
				<isEqual property="sortDirection" compareValue="desc">
					DESC
				</isEqual>
			</isNotEmpty>
			<isEmpty property="paramSortFieldId">
				ORDER BY A.BLD_NUM DESC
			</isEmpty>
		) SUB1
		WHERE 1=1
		<isNotEmpty property="searchTargetData">
			<isNotEmpty property="searchTargetId">
				<isEqual property="searchTargetId" compareValue="bldNum">
					AND	SUB1.BLD_NUM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="bldResult">
					AND	SUB1.BLD_RESULT LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="regUsrNm">
					AND	SUB1.REG_USR_NM LIKE '%'|| #searchTargetData# ||'%'
				</isEqual>
				<isEqual property="searchTargetId" compareValue="bldStartDtm">
					<isNotEmpty property="searchStartDt">
							AND SUB1.BLD_START_DTM &gt;= TO_DATE(#searchStartDt#, 'YYYY-MM-DD HH24:MI:SS')
					</isNotEmpty>
					<isNotEmpty property="searchEndDt">
							AND SUB1.BLD_START_DTM &lt;= TO_DATE(#searchEndDt#, 'YYYY-MM-DD HH24:MI:SS')
					</isNotEmpty>
				</isEqual>
			</isNotEmpty>
		</isNotEmpty>
	</sql>
	
	
    <select id="dpl1000DAO.selectDpl1000DplAllList" parameterClass="java.util.Map"  resultClass="egovMap">
	    
		SELECT 
			Z.*
		FROM ( 
			<include refid="selectDpl1000DplListbase"/>
		) Z
		WHERE 1 = 1
    </select>
	
  	
    <select id="dpl1000DAO.selectDpl1000DplList" parameterClass="java.util.Map"  resultClass="egovMap">
	    
		SELECT 
			Z.*
		FROM ( 
			<include refid="selectDpl1000DplListbase"/>
		) Z
		WHERE 1 = 1
		AND Z.RN BETWEEN (#firstIndex#+1) AND #lastIndex#
    </select>
	
	
	<select id="dpl1000DAO.selectDpl1000DplListCnt" parameterClass="java.util.Map"  resultClass="java.lang.Integer">
	    
		SELECT
			COUNT(*) AS CNT
		FROM ( 
			<include refid="selectDpl1000DplListbase"/>
		) Z
    </select>
    
   	
	<select id="dpl1000DAO.selectDpl1000AllDplList" parameterClass="java.util.Map" resultClass="egovMap">
		
		SELECT
				ROWNUM AS RN
			,	SUB1.LIC_GRP_ID	
			,	SUB1.PRJ_ID
			,	SUB1.DPL_ID
			,	SUB1.DPL_NM
			,	SUB1.DPL_VER
			,	SUB1.DPL_DT
			,	SUB1.DPL_USR_ID
			,	SUB1.DPL_DESC
			,	SUB1.DPL_STS_CD
			,	SUB1.DPL_TYPE_CD
			,	SUB1.DPL_REVISION_NUM
			,	SUB1.DPL_AUTO_AFTER_CD
			,	SUB1.DPL_AUTO_DTM
			,	SUB1.DPL_ST_DTM
			,	SUB1.DPL_RESTORE_CD
			,	SUB1.DPL_SIGN_USE_CD
			,	SUB1.DPL_SIGN_TXT
			, 	SUB1.DPL_AUTO_REPEAT_CD
	        , 	SUB1.DPL_REPEAT_CYCLE_CD
	        , 	SUB1.DPL_REPEAT_ED_DTM
	        , 	SUB1.DPL_REPEAT_DAY_CD
	        ,	SUB1.DPL_REPEAT_DAY_ENG
			,	SUB1.DPL_DEL_CD
			,	SUB1.REG_DTM
			,	SUB1.REG_USR_ID
			,	SUB1.REG_USR_IP
			,	SUB1.MODIFY_DTM
			,	SUB1.MODIFY_USR_ID
			,	SUB1.MODIFY_USR_IP	
			, 	SUB1.TARGET_ID
	       	, 	SUB1.TARGET_CD
	        , 	SUB1.ORD
	        , 	SUB1.LAST_SIGN_USR_ID
	        , 	SUB1.NOW_SIGN_TYPE_CD
			,	SUB1.LAST_ORD
			,	SUB1.SIGN_LINE_ID
		FROM
		(
			SELECT
					B.LIC_GRP_ID
				,	A.PRJ_ID
				,	A.DPL_ID
				,	A.DPL_NM
				,	A.DPL_VER
				,	TO_CHAR(A.DPL_DT, 'YYYY-MM-DD') AS DPL_DT
				,	A.DPL_USR_ID
				,	A.DPL_DESC
				,	A.DPL_STS_CD
				,	A.DPL_TYPE_CD
				,	A.DPL_REVISION_NUM
				,	A.DPL_AUTO_AFTER_CD
				,	A.DPL_AUTO_DTM
				,	TO_DATE(TO_CHAR(A.DPL_DT,'YYYY-MM-DD') || ' ' || TO_CHAR(A.DPL_AUTO_DTM,'HH24:MI:SS'),'YYYY-MM-DD HH24:MI:SS') AS DPL_ST_DTM
				,	A.DPL_RESTORE_CD
				,	A.DPL_SIGN_USE_CD
				,	A.DPL_SIGN_TXT
				, 	A.DPL_AUTO_REPEAT_CD
        		, 	A.DPL_REPEAT_CYCLE_CD
        		,	A.DPL_REPEAT_ED_DTM
        		, 	A.DPL_REPEAT_DAY_CD
        		,	(SELECT X.SUB_CD_REF1 FROM STM4001 X WHERE X.LIC_GRP_ID = B.LIC_GRP_ID AND X.MST_CD = 'CMM00012' AND X.SUB_CD = A.DPL_REPEAT_DAY_CD) AS DPL_REPEAT_DAY_ENG
				,	AUTO_DPL_REVISION_SEL_CD
				,	A.DPL_DEL_CD
				,	A.REG_DTM
				,	A.REG_USR_ID
				,	A.REG_USR_IP
				,	A.MODIFY_DTM
				,	A.MODIFY_USR_ID
				,	A.MODIFY_USR_IP	
				,  	D.TARGET_ID
			    ,	D.TARGET_CD
			    ,	D.ORD
			    ,	CASE WHEN D.SIGN_TYPE_CD='01' OR D.SIGN_TYPE_CD='02' THEN E.ORD ELSE D.ORD END AS LAST_ORD
			    , 	CASE WHEN D.SIGN_TYPE_CD='01' OR D.SIGN_TYPE_CD='02' THEN E.SIGN_USR_ID ELSE D.SIGN_USR_ID END AS LAST_SIGN_USR_ID
				, 	CASE WHEN D.SIGN_TYPE_CD ='01' THEN  '02' ELSE D.SIGN_TYPE_CD END AS NOW_SIGN_TYPE_CD
				,	A.SIGN_LINE_ID
			FROM DPL1000 A
			INNER JOIN PRJ1000 B
			ON (B.PRJ_ID = A.PRJ_ID AND B.DEL_CD = '02' AND B.USE_CD = '01')
			LEFT JOIN	(
							SELECT 	LIC_GRP_ID
								,	PRJ_ID 
								, 	TARGET_ID
								, 	TARGET_CD
								, 	MAX(SIGN_DTM) AS MAX_SIGN_DTM 
                				,	MAX(SIGN_LINE_ID) AS SIGN_LINE_ID
							FROM 	CMM6601 
							GROUP BY  LIC_GRP_ID
									, PRJ_ID
									, TARGET_CD
									, TARGET_ID
						) C
		    ON (A.PRJ_ID = C.PRJ_ID AND A.DPL_ID = C.TARGET_ID)
		    LEFT JOIN CMM6601 D
		    ON (C.LIC_GRP_ID = D.LIC_GRP_ID AND C.PRJ_ID = D.PRJ_ID AND C.TARGET_ID = D.TARGET_ID AND C.TARGET_CD = D.TARGET_CD AND C.MAX_SIGN_DTM = D.SIGN_DTM AND C.SIGN_LINE_ID = D.SIGN_LINE_ID)
		    LEFT JOIN (SELECT * FROM CMM6600 WHERE DEL_CD = '02') E
		    ON (C.LIC_GRP_ID = E.LIC_GRP_ID AND C.PRJ_ID = E.PRJ_ID AND C.TARGET_ID = E.TARGET_ID AND C.TARGET_CD = E.TARGET_CD AND (D.ORD+1) = E.ORD)
			WHERE 1=1
			AND A.DPL_DEL_CD = '02'
			ORDER BY A.REG_DTM DESC	
		) SUB1
		WHERE 1=1
    	AND sub1.DPL_TYPE_CD = '01'
      	AND (SUB1.DPL_SIGN_USE_CD = '02' OR (SUB1.DPL_SIGN_USE_CD = '01' AND SUB1.NOW_SIGN_TYPE_CD = '03'))
	</select>
    
    
    <select id="dpl1000DAO.selectDpl1000DplInfo" parameterClass="java.util.Map"  resultClass="egovMap">
	    
		SELECT 
			Z.*
		FROM ( 
			<include refid="selectDpl1000DplListbase"/>
		) Z
		WHERE 1 = 1
		AND Z.DPL_ID = #dplId#
    </select>
    
    
	<insert id="dpl1000DAO.insertDpl1000DplInfo" parameterClass="java.util.Map">
		<selectKey resultClass="java.lang.String" keyProperty="newDplId">
		<![CDATA[
			 
			SELECT   NVL(
                SUBSTR(NEW_DPL_ID, 1, 11) || LPAD( (TO_NUMBER(SUBSTR(NEW_DPL_ID, 12, 5)) + 1) , 5, '0')
            ,   'DPL' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '00001'
        	) AS NEW_DPL_ID
			FROM
			(
	            SELECT MAX(DPL_ID)  AS NEW_DPL_ID
	            FROM DPL1000 A
	            WHERE 1=1
	            AND A.PRJ_ID = #prjId#
	            AND A.DPL_ID LIKE 'DPL' || TO_CHAR(SYSDATE, 'YYYYMMDD') || '%'
        	)
		]]>
		</selectKey>
		<![CDATA[ 
			
			INSERT INTO DPL1000
			(
					PRJ_ID,						DPL_ID,				DPL_NM,					DPL_VER,			DPL_DT
				,	DPL_USR_ID,					DPL_DESC,			DPL_STS_CD,				DPL_TYPE_CD,		DPL_AUTO_AFTER_CD
				,	DPL_AUTO_DTM,				DPL_RESTORE_CD,		DPL_SIGN_TXT,			DPL_DEL_CD,			DPL_REVISION_NUM
				,	DPL_SIGN_USE_CD,			DPL_AUTO_REPEAT_CD,	DPL_REPEAT_CYCLE_CD,	DPL_REPEAT_ED_DTM, 	DPL_REPEAT_DAY_CD
				,	AUTO_DPL_REVISION_SEL_CD,	REG_DTM,			REG_USR_ID,			REG_USR_IP
				,	MODIFY_DTM,					MODIFY_USR_ID,		MODIFY_USR_IP
					    
			)
			VALUES
			(
					#prjId#,					#newDplId#,			#dplNm#,			#dplVer#,			REPLACE(#dplDt#, '-' ,'')	
				,	#dplUsrId#,					#dplDesc#,			#dplStsCd#,			#dplTypeCd#,		#dplAutoAfterCd#
				,	#dplAutoDtm#,				#dplRestoreCd#,		#dplSignTxt#,		'02',				#dplRevisionNum#
				,	#dplSignUseCd#,				#dplAutoRepeatCd#,	#dplRepeatCycleCd#,	#dplRepeatEdDtm#, 	#dplRepeatDayCd#
				,	#autoDplRevisionSelCd#, 	SYSDATE,			#regUsrId#,			#regUsrIp#
				,	SYSDATE,					#regUsrId#,			#regUsrIp#
			)
		]]>
	</insert>
	
	
	<update id="dpl1000DAO.updateDpl1000DplInfo" parameterClass="java.util.Map">
		
		UPDATE DPL1000 SET    
				DPL_NM 						= #dplNm#		 
			 , 	DPL_VER						= #dplVer#
			 , 	DPL_DT 						= #dplDt#
			 , 	DPL_USR_ID 					= #dplUsrId#
			 , 	DPL_DESC         			= #dplDesc#
			 , 	DPL_STS_CD					= #dplStsCd#
			 , 	DPL_TYPE_CD					= #dplTypeCd#
			 , 	DPL_SIGN_USE_CD				= #dplSignUseCd#
			 , 	DPL_AUTO_AFTER_CD			= #dplAutoAfterCd#
			 , 	DPL_AUTO_DTM				= #dplAutoDtm#
			 , 	DPL_RESTORE_CD				= #dplRestoreCd#
			 ,	DPL_REVISION_NUM 			= #dplRevisionNum#
			 , 	DPL_SIGN_TXT				= #dplSignTxt#
			 ,	DPL_AUTO_REPEAT_CD			= #dplAutoRepeatCd#
			 ,	DPL_REPEAT_CYCLE_CD 		= #dplRepeatCycleCd#
			 ,	DPL_REPEAT_ED_DTM			= #dplRepeatEdDtm#
			 , 	DPL_REPEAT_DAY_CD			= #dplRepeatDayCd#
			 ,	AUTO_DPL_REVISION_SEL_CD	= #autoDplRevisionSelCd#
			 , 	MODIFY_DTM					= SYSDATE
			 , 	MODIFY_USR_ID				= #regUsrId#	
			 , 	MODIFY_USR_IP				= #regUsrIp#
		WHERE 1=1
		AND PRJ_ID = #prjId#			
		AND DPL_ID = #dplId#
	</update>
	
	
	<update id="dpl1000DAO.deleteDpl1000DplInfo" parameterClass="java.util.Map" >
		
		UPDATE DPL1000 A SET
			DPL_DEL_CD = '01'
       	WHERE 1=1
       	AND	A.PRJ_ID = #prjId#
       	AND	A.DPL_ID = #dplId#
	</update>
	
	
	<insert id="dpl1000DAO.insertDpl1300DeployJobInfo" parameterClass="java.util.Map">
		<![CDATA[ 
			
			INSERT INTO DPL1300
			(
					PRJ_ID,				DPL_ID,				JEN_ID
				,	JOB_ID,				JOB_START_ORD,		USE_CD
				,	REG_DTM,			REG_USR_ID,			REG_USR_IP
				,	MODIFY_DTM,			MODIFY_USR_ID,		MODIFY_USR_IP	
					    
			)
			VALUES
			(
					#prjId#,			#dplId#,			#jenId#
				,	#jobId#,			#jobStartOrd#,		'01'
				,	SYSDATE,			#regUsrId#,			#regUsrIp#
				,	SYSDATE,			#regUsrId#,			#regUsrIp#
			)
		]]>
	</insert>
    
  	
	<select id="dpl1000DAO.selectDpl1300DplJobList" parameterClass="java.util.Map" resultClass="egovMap">
		
		<include refid="selectDpl1300DplJobListBase"/>
	</select>
	
	
	<select id="dpl1000DAO.selectDpl1300DplJobPagingList" parameterClass="java.util.Map" resultClass="egovMap">
		
		SELECT Z.*
		FROM
		(
			<include refid="selectDpl1300DplJobListBase"/>
		) Z
		WHERE RN BETWEEN (#firstIndex#+1) AND #lastIndex#
	</select>
	
	
    <select id="dpl1000DAO.selectDpl1300DplJobPagingListCnt" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		
		SELECT COUNT(*) AS CNT
		FROM 
		( 
			<include refid="selectDpl1300DplJobListBase"/>
		) Z
	</select>
    
    
    <select id="dpl1000DAO.selectDpl1400DplBldNumList" parameterClass="java.util.Map" resultClass="egovMap">
		
		SELECT Z.*
		FROM
		(
			<include refid="selectDpl1400DplBldNumBase"/>
		) Z
		WHERE RN BETWEEN (#firstIndex#+1) AND #lastIndex#
	</select>
	
    
    <select id="dpl1000DAO.selectDpl1400DplBldNumListCnt" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		
		SELECT COUNT(*) AS CNT
		FROM 
		( 
			<include refid="selectDpl1400DplBldNumBase"/>
		) Z
	</select>
	
	
	<delete id="dpl1000DAO.deleteDpl1300DplJobList" parameterClass="java.util.Map">
		
		DELETE FROM	DPL1300
		WHERE 1=1
		AND PRJ_ID = #prjId#
		AND	DPL_ID = #dplId# 
	</delete>
    
    
    <select id="dpl1000DAO.selectCmm6601SignHistoryList" parameterClass="java.util.Map" resultClass="egovMap">
    	
		SELECT
				SUB1.LIC_GRP_ID
			,	SUB1.PRJ_ID
			,	SUB1.SIGN_LINE_ID
			,	SUB1.TARGET_CD
			,	SUB1.TARGET_ID
			,	SUB1.ORD
			,	SUB1.SIGN_USR_ID
			,	SF_STM3000_USR_INFO(SUB1.SIGN_USR_ID, '1')  AS SIGN_USR_NM
			,	SF_STM3000_USR_INFO(SUB1.SIGN_USR_ID, '2')  AS SIGN_USR_EMAIL
			,	SF_STM3000_USR_INFO(SUB1.SIGN_USR_ID, '6')  AS SIGN_USR_IMG_ID
			,	SUB1.SIGN_TYPE_CD
			,	SF_STM4001_COM_CD_INFO(#licGrpId#, 'CMM00008', SUB1.SIGN_TYPE_CD, '1') AS SIGN_TYPE_NM
			,	SUB1.SIGN_RES
			,	SUB1.SIGN_DTM
			,	SUB1.NEXT_USR_ID
			,	SF_STM3000_USR_INFO(SUB1.NEXT_USR_ID, '1')  AS NEXT_USR_NM
			,	SF_STM3000_USR_INFO(SUB1.NEXT_USR_ID, '2')  AS NEXT_USR_EMAIL
			,	SF_STM3000_USR_INFO(SUB1.NEXT_USR_ID, '6')  AS NEXT_USR_IMG_ID
			,	SUB1.REG_DTM
			,	SUB1.REG_USR_ID
			,	SUB1.REG_USR_IP
			,	SUB1.MODIFY_DTM
			,	SUB1.MODIFY_USR_ID
			,	SUB1.MODIFY_USR_IP
			,	SUB1.TYPE
		FROM
		(
			SELECT	
		    			A.LIC_GRP_ID
		    		,	A.PRJ_ID
		    		,	A.SIGN_LINE_ID
		    		,	A.TARGET_CD
		    		,	A.TARGET_ID
		    		,	A.ORD
		    		,	A.SIGN_USR_ID
		    		,	A.SIGN_TYPE_CD
		    		,	NVL(A.SIGN_RES,'') AS SIGN_RES
		    		,	TO_CHAR(A.SIGN_DTM, 'YYYY-MM-DD HH24:MI:SS') AS SIGN_DTM
		    		,	A.REG_DTM
		    		,	A.REG_USR_ID
		    		,	A.REG_USR_IP
		    		,	A.MODIFY_DTM
		    		,	A.MODIFY_USR_ID
		    		,	A.MODIFY_USR_IP
		    		,	B.SIGN_USR_ID AS NEXT_USR_ID
		    		,	'SIG' AS TYPE
		    	<isNotEqual property="sprTypeCd" compareValue="03">
		    	FROM	CMM6601 A
		    	LEFT JOIN CMM6600 B
		    	ON (A.LIC_GRP_ID = B.LIC_GRP_ID AND A.PRJ_ID = B.PRJ_ID AND A.TARGET_ID =B.TARGET_ID AND A.TARGET_CD =B.TARGET_CD AND (A.ORD+1) = B.ORD AND A.SIGN_LINE_ID = B.SIGN_LINE_ID)
		    	WHERE   1 = 1
		    	AND		A.LIC_GRP_ID = #licGrpId#
		    	AND		A.PRJ_ID	   = #prjId#
		    	AND		A.TARGET_ID  = #targetId#
    			AND		A.TARGET_CD  = #targetCd#
    			</isNotEqual>
    			<isEqual property="sprTypeCd" compareValue="03">
    			FROM	SNP_CMM6601 A
				LEFT JOIN SNP_CMM6600 B
				ON (A.LIC_GRP_ID = B.LIC_GRP_ID AND A.PRJ_GRP_ID = B.PRJ_GRP_ID AND A.PRJ_ID = B.PRJ_ID AND A.SPR_ID = B.SPR_ID AND A.TARGET_ID =B.TARGET_ID AND A.TARGET_CD =B.TARGET_CD AND (A.ORD+1) = B.ORD AND A.SIGN_LINE_ID = B.SIGN_LINE_ID)
				WHERE   1 = 1
		    	AND		A.LIC_GRP_ID = #licGrpId#
		    	AND 	A.PRJ_GRP_ID = #prjGrpId#
		    	AND		A.PRJ_ID	  = #prjId#
		    	AND 	A.SPR_ID	 = #sprId#
		    	AND		A.TARGET_ID  = #targetId#
    			AND		A.TARGET_CD  = #targetCd#
    			</isEqual>
		) SUB1
		WHERE 1=1
		ORDER BY SUB1.SIGN_DTM DESC
    </select>
    
    
     <select id="dpl1000DAO.selectDpl1000DplAllBldHistoryList" parameterClass="java.util.Map" resultClass="egovMap">
     	
     		SELECT
            		ROWNUM AS RN
                ,	SUB1.TYPE
                , 	SUB1.PRJ_ID
                , 	SUB1.DPL_ID
                , 	SUB1.JEN_ID
                , 	SUB1.JOB_ID
                , 	SUB1.BLD_SEQ
                , 	SUB1.BLD_NUM
                , 	SUB1.BLD_RESULT
                , 	(SELECT X.SUB_CD_NM FROM STM4001 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.MST_CD = 'DPL00002' AND X.SUB_CD = SUB1.JOB_TYPE_CD) AS JOB_TYPE_NM
                , 	SUB1.REG_DTM
                , 	SUB1.BLD_RESULT_MSG
               	, 	SUB1.REG_USR_ID
                ,	(SELECT X.USR_NM FROM STM3000 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.USR_ID = SUB1.REG_USR_ID)  AS REG_USR_NM
                ,	(SELECT X.USR_IMG_ID FROM STM3000 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.USR_ID = SUB1.REG_USR_ID)  AS REG_USR_IMG_ID
                ,	(SELECT X.EMAIL FROM STM3000 X WHERE X.LIC_GRP_ID = #licGrpId# AND X.USR_ID = SUB1.REG_USR_ID)  AS REG_USR_EMAIL
            FROM
            (
 				SELECT 
						'BLD' AS TYPE
					,	A.PRJ_ID
                    , 	A.DPL_ID
                    , 	A.JEN_ID
                    , 	A.JOB_ID
                    , 	A.BLD_SEQ
                    , 	A.BLD_NUM
                    , 	A.BLD_RESULT
                    , 	B.JOB_TYPE_CD
                    , 	A.REG_DTM
                    , 	A.BLD_RESULT_MSG
                    , 	A.REG_USR_ID
                FROM DPL1400 A 
                LEFT JOIN STM9001 B 
                ON(B.LIC_GRP_ID = #licGrpId# AND B.JEN_ID = A.JEN_ID AND B.JOB_ID = A.JOB_ID)
                WHERE 1=1
                AND A.PRJ_ID = #prjId#
                AND A.DPL_ID = #dplId#
                ORDER BY A.REG_DTM DESC
            ) SUB1
     </select>
     
    
	<select id="dpl1000DAO.selectDpl1400DplSelBuildInfo" parameterClass="java.util.Map" resultMap="resultMapDpl1400SelBuildInfo">
		<![CDATA[
			
			SELECT
					SUB1.PRJ_ID
				,	SUB1.DPL_ID
				,	(SELECT X.DPL_NM FROM DPL1000 X WHERE X.PRJ_ID = SUB1.PRJ_ID AND X.DPL_ID = SUB1.DPL_ID) AS DPL_NM
				,	SUB1.JEN_ID
				,	SUB1.JOB_ID
				,	SUB1.JOB_RESTORE_ID
				,	SUB1.BLD_SEQ
				,	SUB1.BLD_NUM
				,	SUB1.BLD_MAIN_NUM
				,	SUB1.BLD_RESULT
				,	SUB1.BLD_RESULT_MSG
				,	SUB1.BLD_DURATION_TM
				,	SUB1.BLD_START_DTM
				,	SUB1.BLD_CONSOLE_LOG
				,	SUB1.BLD_RESTORE_NUM
				,	SUB1.BLD_RESTORE_RESULT
				,	SUB1.BLD_RESTORE_RESULT_MSG
				,	SUB1.BLD_CONSOLE_RESTORE_LOG
				,	SUB1.REG_DTM
				,	SUB1.REG_USR_ID
				,	SUB1.REG_USR_IP
				,	SUB1.MODIFY_DTM
				,	SUB1.MODIFY_USR_ID
				,	SUB1.MODIFY_USR_IP
			FROM
			(
				SELECT
						A.PRJ_ID
					,	A.DPL_ID
					,	A.JEN_ID
					,	A.JOB_ID
					,	B.JOB_RESTORE_ID
					,	A.BLD_SEQ
					,	A.BLD_NUM
					,	A.BLD_MAIN_NUM
					,	A.BLD_RESULT
					,	A.BLD_RESULT_MSG
					,	A.BLD_DURATION_TM
					,	A.BLD_START_DTM
					,	A.BLD_CONSOLE_LOG
					,	'' AS BLD_RESTORE_NUM
					,	'' AS BLD_RESTORE_RESULT
					,	'' AS BLD_RESTORE_RESULT_MSG
					,	'' AS BLD_CONSOLE_RESTORE_LOG
					,	A.REG_DTM
					,	A.REG_USR_ID
					,	A.REG_USR_IP
					,	A.MODIFY_DTM
					,	A.MODIFY_USR_ID
					,	A.MODIFY_USR_IP
			]]>
				<isNotEqual property="sprTypeCd" compareValue="03">
				FROM DPL1400 A 
				LEFT JOIN STM9001 B 
				ON(B.LIC_GRP_ID = #licGrpId# AND B.JEN_ID = A.JEN_ID AND B.JOB_ID = A.JOB_ID)
				WHERE 1=1
				AND A.PRJ_ID = #prjId# 
				AND A.DPL_ID = #dplId# 
				AND A.JEN_ID = #jenId#
				AND A.JOB_ID = #jobId#
				AND A.BLD_SEQ = #bldSeq#
				</isNotEqual>
				<isEqual property="sprTypeCd" compareValue="03">
				FROM SNP_DPL1400 A 
				LEFT JOIN SNP_STM9001 B 
				ON(A.LIC_GRP_ID = B.LIC_GRP_ID AND A.PRJ_GRP_ID = B.PRJ_GRP_ID AND A.PRJ_ID = B.PRJ_ID AND A.SPR_ID = B.SPR_ID AND B.JEN_ID = A.JEN_ID AND B.JOB_ID = A.JOB_ID)
				WHERE 1 = 1
				AND A.LIC_GRP_ID = #licGrpId#
				AND A.PRJ_GRP_ID = #prjGrpId#
				AND A.PRJ_ID = #prjId#
				AND A.SPR_ID = #sprId#
				AND A.DPL_ID = #dplId# 
				AND A.JEN_ID = #jenId#
				AND A.JOB_ID = #jobId#
				AND A.BLD_SEQ = #bldSeq#
				</isEqual>
			) SUB1
		
	</select>
	
	
	<update id="dpl1000DAO.updateDpl1000DplStsCdInfo" parameterClass="java.util.Map">
		
		UPDATE DPL1000 SET    
				DPL_STS_CD 		= #dplStsCd#
			,	MODIFY_DTM		= SYSDATE
			,	MODIFY_USR_ID	= #modifyUsrId#	
			,	MODIFY_USR_IP	= #modifyUsrIp#
		WHERE 1=1
		AND PRJ_ID = #prjId#			
		AND DPL_ID = #dplId#
	</update>
    
    
    <update id="dpl1000DAO.updateDpl1000DplSignLineId" parameterClass="java.util.Map">
    	
    	UPDATE 	DPL1000
    	SET		SIGN_LINE_ID = #signLineId#
    	WHERE	1 = 1
    	AND		PRJ_ID = #prjId#
    	AND		DPL_ID = #dplId#
    </update>
    	
	
	<select id="dpl1000DAO.selectDpl1000DplIdList" parameterClass="java.util.Map" resultClass="java.lang.String">
		<![CDATA[
			
			SELECT A.DPL_ID
			FROM DPL1100 A
			WHERE 1=1
			AND A.PRJ_ID = #prjId#
			AND A.REQ_ID = #reqId#
			AND A.PROCESS_ID = #processId#
			AND A.FLOW_ID = #flowId#
		]]>
	</select>
	
	
	<insert id="dpl1000DAO.insertDpl1400DeployJobBuildLogInfo" parameterClass="BuildVO">
		<selectKey resultClass="java.lang.Integer" keyProperty="bldSeq">
		<![CDATA[
			 
			SELECT NVL(MAX(BLD_SEQ)+1,1) AS NEW_BLD_SEQ
			FROM DPL1400 A
			WHERE 1=1
			AND A.PRJ_ID = #prjId#
			AND A.DPL_ID = #dplId# 
			AND A.JEN_ID = #jenId#
			AND A.JOB_ID = #jobId#
		]]>
		</selectKey>
		<![CDATA[ 
			
			INSERT INTO DPL1400
			(
				PRJ_ID					,DPL_ID						,JEN_ID					,JOB_ID
				,BLD_SEQ				,BLD_NUM					,BLD_MAIN_NUM			,BLD_RESULT
				,BLD_DURATION_TM		,BLD_START_DTM				,BLD_CONSOLE_LOG		,BLD_RESULT_MSG
				,REG_DTM				,REG_USR_ID					,REG_USR_IP				,BLD_RESULT_CD
					    
			)
			VALUES
			(
				#prjId#					,#dplId#					,#jenId#				,#jobId#
				,#bldSeq#				,#bldNum#					,#bldMainNum#			,#bldResult#
				,#estimatedDuration#	,#bldStartDtm#				,#bldConsoleLog#		,#bldResultMsg#
				,SYSDATE				,#regUsrId#					,#regUsrIp#				,#bldResultCd#
			)
		]]>
	</insert>
	
		
	
	<insert id="dpl1000DAO.insertDpl1600DeployBuildChgPathLogInfo" parameterClass="ChangePathsVO">
		<![CDATA[ 
			
			INSERT INTO DPL1700
			(
				PRJ_ID					,DPL_ID						,JEN_ID					,JOB_ID
				,BLD_SEQ				,CHG_REVISION				,EDIT_TYPE_CD			,FILE_PATH
				,REG_DTM				,REG_USR_ID					,REG_USR_IP		
					    
			)
			VALUES
			(
				#prjId#					,#dplId#					,#jenId#				,#jobId#
				,#bldSeq#				,#revision#				,#editTypeCd#			,#filePath#
				,SYSDATE				,#regUsrId#					,#regUsrIp#
			)
		]]>
	</insert>
	
		
	
	<insert id="dpl1000DAO.insertDpl1600DeployBuildChgLogInfo" parameterClass="ChangeVO">
		<![CDATA[ 
			
			INSERT INTO DPL1600
			(
				PRJ_ID					,DPL_ID						,JEN_ID					,JOB_ID
				,BLD_SEQ				,CHG_TIMESTAMP				,CHG_DATE				,CHG_MSG
				,CHG_REVISION			,CHG_USER
				,REG_DTM				,REG_USR_ID					,REG_USR_IP		
					    
			)
			VALUES
			(
				#prjId#					,#dplId#					,#jenId#				,#jobId#
				,#bldSeq#				,#timestamp#				,#date#					,#msg# 
				,#revision#				,#user#
				,SYSDATE				,#regUsrId#					,#regUsrIp#
			)
		]]>
	</insert>
	
		
	
	<select id="dpl1000DAO.selectDpl1700SvnChangePathList" parameterClass="java.util.Map" resultClass="egovMap">
		<![CDATA[
			
			SELECT 
				A.PRJ_ID
				, A.DPL_ID
				, A.JEN_ID
				, A.JOB_ID
				, A.BLD_SEQ
				, A.CHG_REVISION
				, A.FILE_PATH
				, A.EDIT_TYPE_CD
				, A.REG_DTM
				, A.REG_USR_ID
				, A.REG_USR_IP
				, A.MODIFY_DTM
				, A.MODIFY_USR_ID
				, A.MODIFY_USR_IP
			FROM DPL1700 A
			WHERE 1=1
				AND A.PRJ_ID = #prjId# 
				AND A.DPL_ID = #dplId# 
				AND A.JEN_ID = #jenId#
				AND A.JOB_ID = #jobId#
				AND A.BLD_SEQ = #bldSeq#
			ORDER BY REG_DTM DESC
		]]>
	</select>
	
	
	<select id="dpl1000DAO.selectDpl1600SvnChangeLogsList" parameterClass="java.util.Map" resultClass="egovMap">
		<![CDATA[
			
			SELECT 
				A.PRJ_ID
				, A.DPL_ID
				, A.JEN_ID
				, A.JOB_ID
				, A.BLD_SEQ
				, A.CHG_REVISION
				, A.CHG_TIMESTAMP
				, A.CHG_DATE
				, A.CHG_MSG
				, A.CHG_USER
				, A.REG_DTM
				, A.REG_USR_ID
				, A.REG_USR_IP
				, A.MODIFY_DTM
				, A.MODIFY_USR_ID
				, A.MODIFY_USR_IP
			FROM DPL1600 A
			WHERE 1=1
				AND A.PRJ_ID = #prjId# 
				AND A.DPL_ID = #dplId# 
				AND A.JEN_ID = #jenId#
				AND A.JOB_ID = #jobId#
				AND A.BLD_SEQ = #bldSeq# 
			ORDER BY A.CHG_REVISION DESC
		]]>
	</select>

</sqlMap>
